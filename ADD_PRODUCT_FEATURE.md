# 添加商品功能说明

## 功能概述

在订单确认页面添加了"添加更多商品"功能，用户可以通过点击加号按钮跳转到产品展示界面，选择新商品后返回订单确认页面，新选择的商品会与之前的商品一起显示。

## 主要功能

### 1. 添加商品按钮
- 在订单确认页面的商品清单末尾添加了一个"+"按钮
- 按钮样式为虚线边框，悬停时有动画效果
- 点击后跳转到产品展示页面

### 2. 数据持久化
- 使用 localStorage 保存订单确认页面的数据
- 保存内容包括：商品列表、选中的尺码、商品数量、收货地址
- 数据有效期为24小时，过期后自动清除

### 3. 商品合并逻辑
- 当从产品详情页跳转到订单确认页面时，会检查商品是否已存在
- 如果商品已存在，会增加数量而不是重复添加
- 如果商品不存在，会添加到商品列表中

## 技术实现

### 新增函数

1. **`saveOrderData()`**
   - 保存当前订单数据到 localStorage
   - 包含时间戳用于数据过期检查

2. **`restoreOrderData()`**
   - 从 localStorage 恢复订单数据
   - 检查数据是否过期（24小时）
   - 返回是否成功恢复数据

3. **`clearOrderData()`**
   - 清除 localStorage 中的订单数据
   - 在支付成功后调用

4. **`addMoreProducts()`**
   - 保存当前数据并跳转到产品展示页面

### 修改的函数

1. **`loadOrderData()`**
   - 首先尝试恢复保存的数据
   - 处理新商品的添加逻辑
   - 支持商品数量合并

2. **`goBack()`**
   - 在返回前保存当前数据

3. **支付成功处理**
   - 在支付成功后清除保存的数据

## 使用流程

1. **用户进入订单确认页面** → 选择商品、尺码、数量、地址
2. **点击"+"按钮** → 数据保存到 localStorage → 跳转到产品展示页面
3. **选择新商品** → 点击"立即购买" → 跳转到订单确认页面
4. **系统处理** → 恢复之前的数据 → 添加新商品到列表
5. **支付成功** → 清除保存的数据

## 数据存储结构

```javascript
{
  products: [], // 商品列表
  selectedSizes: {}, // 选中的尺码 {shoeId: sizeId}
  productQuantities: {}, // 商品数量 {shoeId: quantity}
  selectedAddress: {}, // 选中的收货地址
  timestamp: 1234567890 // 时间戳
}
```

## 样式设计

### 添加商品卡片
- 虚线边框设计，突出可点击性
- 悬停时边框变蓝，背景色变化
- 加号图标和文字提示
- 响应式设计，适配不同屏幕

### 动画效果
- 悬停时卡片上移效果
- 颜色渐变过渡
- 图标颜色变化

## 错误处理

1. **数据恢复失败**
   - 清除损坏的数据
   - 重新加载默认商品列表

2. **商品添加失败**
   - 显示错误提示
   - 保持原有数据不变

3. **数据过期**
   - 自动清除过期数据
   - 重新开始购物流程

## 兼容性

- 支持所有现代浏览器
- 使用 localStorage API 进行数据存储
- 响应式设计，支持移动端

## 注意事项

1. **数据安全**
   - 数据仅存储在本地，不会上传到服务器
   - 24小时自动过期，避免数据堆积

2. **用户体验**
   - 数据恢复过程对用户透明
   - 提供清晰的视觉反馈

3. **性能考虑**
   - 数据量较小，不影响页面加载速度
   - 异步处理数据恢复

## 测试场景

### 场景1：基本添加商品
1. 进入订单确认页面
2. 选择商品和尺码
3. 点击"+"按钮
4. 选择新商品并购买
5. 验证商品合并正确

### 场景2：重复商品处理
1. 添加相同商品多次
2. 验证数量正确累加
3. 验证不会重复显示

### 场景3：数据持久化
1. 添加商品后刷新页面
2. 验证数据正确恢复
3. 验证过期数据清理

### 场景4：支付后清理
1. 完成支付流程
2. 验证数据被清除
3. 重新进入页面验证无残留数据

