<template>
    <div class="product-detail-container">
        <!-- Âä†ËΩΩÁä∂ÊÄÅ -->
        <div v-if="loading" class="loading-container">
            <div class="loading-spinner"></div>
            <p>Ê≠£Âú®Âä†ËΩΩ‰∫ßÂìÅËØ¶ÊÉÖ...</p>
        </div>

        <!-- ÈîôËØØÁä∂ÊÄÅ -->
        <div v-else-if="error" class="error-container">
            <div class="error-icon">‚ùå</div>
            <h3>Âä†ËΩΩÂ§±Ë¥•</h3>
            <p>{{ error }}</p>
            <button @click="loadProductDetail" class="retry-btn">ÈáçËØï</button>
        </div>

        <!-- ‰∫ßÂìÅËØ¶ÊÉÖÂÜÖÂÆπ -->
        <div v-else-if="product" class="product-detail-content">
            <!-- Èù¢ÂåÖÂ±ëÂØºËà™ -->
            <div class="breadcrumb">
                <router-link to="/home" class="breadcrumb-item">È¶ñÈ°µ</router-link>
                <span class="breadcrumb-separator">/</span>
                <router-link to="/products" class="breadcrumb-item">‰∫ßÂìÅÂàóË°®</router-link>
                <span class="breadcrumb-separator">/</span>
                <span class="breadcrumb-current">{{ product.name }}</span>
            </div>

            <!-- ‰∫ßÂìÅ‰∏ªË¶Å‰ø°ÊÅØÂå∫Âüü -->
            <div class="product-main-section">
                <!-- Â∑¶‰æßÂõæÁâáÂ±ïÁ§∫Âå∫Âüü -->
                <div class="product-images-section">
                    <!-- ‰∏ªÂõæÁâáÂ±ïÁ§∫ -->
                    <div class="main-image-container">
                        <div 
                            class="main-image-wrapper"
                            @mousemove="handleImageZoom"
                            @mouseleave="hideZoom"
                            ref="mainImageWrapper"
                        >
                            <img 
                                :src="currentMainImage" 
                                :alt="product.name"
                                class="main-image"
                                ref="mainImage"
                            >
                            <!-- ÊîæÂ§ßÈïúÊïàÊûú -->
                            <div 
                                v-show="showZoom"
                                class="zoom-lens"
                                :style="zoomLensStyle"
                            ></div>
                        </div>
                        
                        <!-- ÊîæÂ§ßÂêéÁöÑÂõæÁâá - Âõ∫ÂÆöÂú®Âè≥‰æß -->
                        <div 
                            v-show="showZoom"
                            class="zoomed-image-container"
                        >
                            <img 
                                :src="currentMainImage" 
                                :alt="product.name"
                                class="zoomed-image"
                                :style="zoomedImageStyle"
                            >
                        </div>
                    </div>

                    <!-- Áº©Áï•ÂõæÂàóË°® -->
                    <div v-if="product.images && product.images.length > 1" class="thumbnail-list">
                        <div 
                            v-for="(image, index) in product.images" 
                            :key="image.imgId"
                            class="thumbnail-item"
                            :class="{ 'active': currentImageIndex === index }"
                            @click="selectImage(index)"
                        >
                            <img 
                                :src="`/api/shoeImg/getImage/${image.imagePath}`"
                                :alt="`${product.name} ${index + 1}`"
                                class="thumbnail-image"
                            >
                        </div>
                    </div>
                </div>

                <!-- Âè≥‰æß‰∫ßÂìÅ‰ø°ÊÅØÂå∫Âüü -->
                <div class="product-info-section">
                    <!-- ‰∫ßÂìÅÊ†áÈ¢ò -->
                    <h1 class="product-title">{{ product.name }}</h1>
                    
                    <!-- ‰∫ßÂìÅÁºñÂè∑ -->
                    <div class="product-serial">
                        <span class="label">‰∫ßÂìÅÁºñÂè∑Ôºö</span>
                        <span class="value">{{ product.serialNumber }}</span>
                    </div>

                    <!-- ‰ª∑Ê†º‰ø°ÊÅØ -->
                    <div class="price-section">
                        <div class="current-price">
                            <span class="label">Áé∞‰ª∑Ôºö</span>
                            <span class="price">¬•{{ product.discountPrice || product.price }}</span>
                        </div>
                        <div v-if="product.discountPrice" class="original-price">
                            <span class="label">Âéü‰ª∑Ôºö</span>
                            <span class="price">¬•{{ product.price }}</span>
                        </div>
                    </div>

                    <!-- ÁßØÂàÜ‰ø°ÊÅØ -->
                    <div class="points-section">
                        <span class="label">ÂèØËé∑ÂæóÁßØÂàÜÔºö</span>
                        <span class="value">{{ product.points || 0 }} ÂàÜ</span>
                    </div>

                    <!-- ÈîÄÈáè‰ø°ÊÅØ -->
                    <div class="sales-section">
                        <span class="label">Â∑≤ÂîÆÂá∫Êï∞ÈáèÔºö</span>
                        <span class="value">{{ product.salesVolume || 0 }} Âèå</span>
                    </div>

                    <!-- Â∞∫Á†ÅÈÄâÊã© -->
                    <div class="size-section">
                        <h3 class="section-title">ÈÄâÊã©Â∞∫Á†Å</h3>
                        <div class="size-options">
                            <button 
                                v-for="size in availableSizes" 
                                :key="size.sizeId"
                                class="size-option"
                                :class="{ 
                                    'selected': selectedSize === size.sizeId,
                                    'disabled': !size.hasStock
                                }"
                                @click="selectSize(size.sizeId)"
                                :disabled="!size.hasStock"
                            >
                                {{ size.size }}
                                <span v-if="size.hasStock" class="stock-info">({{ size.stock }}Âèå)</span>
                                <span v-else class="stock-info">(Êó†Â∫ìÂ≠ò)</span>
                            </button>
                        </div>
                    </div>

                    <!-- Ë¥≠‰π∞Êï∞Èáè -->
                    <div class="quantity-section">
                        <h3 class="section-title">Ë¥≠‰π∞Êï∞Èáè</h3>
                        <div class="quantity-controls">
                            <button 
                                @click="decreaseQuantity" 
                                class="quantity-btn"
                                :disabled="quantity <= 1"
                            >
                                -
                            </button>
                            <input 
                                v-model.number="quantity" 
                                type="number" 
                                min="1" 
                                :max="maxQuantity"
                                class="quantity-input"
                                @input="validateQuantity"
                            >
                            <button 
                                @click="increaseQuantity" 
                                class="quantity-btn"
                                :disabled="quantity >= maxQuantity"
                            >
                                +
                            </button>
                        </div>
                        <div v-if="selectedSize" class="stock-warning">
                            ÂΩìÂâçÂ∞∫Á†ÅÂ∫ìÂ≠ò: {{ getCurrentSizeStock() }} Âèå
                        </div>
                    </div>

                    <!-- ‰∫ßÂìÅÊ†áÁ≠æ -->
                    <div class="product-tags">
                        <span class="tag brand-tag">{{ product.brand?.brandName || 'N/A' }}</span>
                        <span class="tag type-tag">{{ product.shoesType?.typeName || 'N/A' }}</span>
                        <span class="tag color-tag">{{ product.color?.colorName || 'N/A' }}</span>
                        <span class="tag sex-tag">{{ getShoeSexText(product.shoeSex) }}</span>
                    </div>

                    <!-- Êìç‰ΩúÊåâÈíÆ -->
                    <div class="action-buttons">
                        <button @click="addToCart" class="add-to-cart-btn" :disabled="!selectedSize">
                            üõí Âä†ÂÖ•Ë¥≠Áâ©ËΩ¶
                        </button>
                        <button @click="buyNow" class="buy-now-btn" :disabled="!selectedSize">
                            üí≥ Á´ãÂç≥Ë¥≠‰π∞
                        </button>
                    </div>
                </div>
            </div>

            <!-- ‰∫ßÂìÅËØ¶ÁªÜ‰ø°ÊÅØ -->
            <div class="product-details-section">
                <h2 class="section-title">‰∫ßÂìÅËØ¶ÁªÜ‰ø°ÊÅØ</h2>
                
                <div class="details-grid">
                    <div class="detail-item">
                        <span class="detail-label">‰∫ßÂìÅÂêçÁß∞Ôºö</span>
                        <span class="detail-value">{{ product.name }}</span>
                    </div>
                    
                    <div class="detail-item">
                        <span class="detail-label">‰∫ßÂìÅÁºñÂè∑Ôºö</span>
                        <span class="detail-value">{{ product.serialNumber }}</span>
                    </div>
                    
                    <div class="detail-item">
                        <span class="detail-label">ÂìÅÁâåÔºö</span>
                        <span class="detail-value">{{ product.brand?.brandName || 'N/A' }}</span>
                    </div>
                    
                    <div class="detail-item">
                        <span class="detail-label">ÁâàÂûãÔºö</span>
                        <span class="detail-value">{{ product.shoesType?.typeName || 'N/A' }}</span>
                    </div>
                    
                    <div class="detail-item">
                        <span class="detail-label">È¢úËâ≤Ôºö</span>
                        <span class="detail-value">{{ product.color?.colorName || 'N/A' }}</span>
                    </div>
                    
                    <div class="detail-item">
                        <span class="detail-label">ÈÄÇÁî®ÊÄßÂà´Ôºö</span>
                        <span class="detail-value">{{ getShoeSexText(product.shoeSex) }}</span>
                    </div>
                    
                    <div class="detail-item">
                        <span class="detail-label">Âéü‰ª∑Ôºö</span>
                        <span class="detail-value">¬•{{ product.price }}</span>
                    </div>
                    
                    <div v-if="product.discountPrice" class="detail-item">
                        <span class="detail-label">Áé∞‰ª∑Ôºö</span>
                        <span class="detail-value discount">¬•{{ product.discountPrice }}</span>
                    </div>
                    
                    <div class="detail-item">
                        <span class="detail-label">ÂèØËé∑ÂæóÁßØÂàÜÔºö</span>
                        <span class="detail-value">{{ product.points || 0 }} ÂàÜ</span>
                    </div>
                    
                    <div class="detail-item">
                        <span class="detail-label">Â∑≤ÂîÆÂá∫Êï∞ÈáèÔºö</span>
                        <span class="detail-value">{{ product.salesVolume || 0 }} Âèå</span>
                    </div>
                    
                    <div v-if="product.origin" class="detail-item">
                        <span class="detail-label">‰∫ßÂú∞Ôºö</span>
                        <span class="detail-value">{{ product.origin }}</span>
                    </div>
                    
                    <div v-if="product.launchDate" class="detail-item">
                        <span class="detail-label">‰∏äÂ∏ÇÊó•ÊúüÔºö</span>
                        <span class="detail-value">{{ formatDate(product.launchDate) }}</span>
                    </div>
                </div>

                <!-- ‰∫ßÂìÅÊèèËø∞ -->
                <div v-if="product.description" class="description-section">
                    <h3 class="subsection-title">‰∫ßÂìÅÊèèËø∞</h3>
                    <p class="description-text">{{ product.description }}</p>
                </div>
            </div>
        </div>
    </div>
</template>

<script setup>
import { ref, onMounted, computed } from 'vue'
import { useRoute, useRouter } from 'vue-router'
import axios from 'axios'
import cartManager from '@/utils/cart'
import userManager from '@/utils/userManager'

// Ë∑ØÁî±Áõ∏ÂÖ≥
const route = useRoute()
const router = useRouter()

// ÂìçÂ∫îÂºèÊï∞ÊçÆ
const product = ref(null)
const loading = ref(true)
const error = ref('')
const inventoryData = ref(null)

// ÂõæÁâáÁõ∏ÂÖ≥
const currentImageIndex = ref(0)
const showZoom = ref(false)
const zoomLensStyle = ref({})
const zoomedImageStyle = ref({})

// ÈÄâÊã©Áõ∏ÂÖ≥
const selectedSize = ref(null)
const quantity = ref(1)

// Ê®°ÊùøÂºïÁî®
const mainImageWrapper = ref(null)
const mainImage = ref(null)

// ËÆ°ÁÆóÂ±ûÊÄß
const currentMainImage = computed(() => {
    if (product.value?.images && product.value.images.length > 0) {
        return `/api/shoeImg/getImage/${product.value.images[currentImageIndex.value].imagePath}`
    }
    return ''
})

const availableSizes = computed(() => {
    if (!inventoryData.value || !Array.isArray(inventoryData.value)) return []
    
    return inventoryData.value.map(item => ({
        sizeId: item.sizeId,
        size: item.size,
        stock: item.inventoryNumber,
        hasStock: item.inventoryNumber > 0
    }))
})

const maxQuantity = computed(() => {
    if (!selectedSize.value || !inventoryData.value || !Array.isArray(inventoryData.value)) return 99
    
    const selectedInventory = inventoryData.value.find(item => item.sizeId === selectedSize.value)
    return selectedInventory ? Math.min(selectedInventory.inventoryNumber, 99) : 99
})

// Ëé∑ÂèñÈûãÂ≠êÊÄßÂà´ÊñáÊú¨
const getShoeSexText = (shoeSex) => {
    if (!shoeSex) return 'N/A'
    
    switch (Number(shoeSex)) {
        case 1:
            return 'Áî∑Èûã'
        case 2:
            return 'Â•≥Èûã'
        case 3:
            return 'Á´•Èûã'
        case 4:
            return 'ÂÖ∂‰ªñ'
        default:
            return 'Êú™Áü•'
    }
}





// Ëé∑Âèñ‰∫ßÂìÅËØ¶ÊÉÖ
const loadProductDetail = async () => {
    const shoeId = route.params.id || route.query.shoeId
    
    if (!shoeId) {
        error.value = 'Áº∫Â∞ë‰∫ßÂìÅIDÂèÇÊï∞'
        loading.value = false
        return
    }

    loading.value = true
    error.value = ''

    try {
        // Ë∞ÉÁî®ÂêéÁ´ØÊé•Âè£Ëé∑Âèñ‰∫ßÂìÅËØ¶ÊÉÖ
        const response = await axios.post('/shoe/getById', 
            `shoeId=${shoeId}`,
            { headers: { 'Content-Type': 'application/x-www-form-urlencoded' } }
        )

        if (response.data && response.data.code === 200 && response.data.data) {
            const productData = response.data.data
            
            // Ëé∑Âèñ‰∫ßÂìÅÂõæÁâá
            try {
                const imageResponse = await axios.get(`/shoeImg/list/${shoeId}`)
                if (imageResponse.data && imageResponse.data.data) {
                    productData.images = imageResponse.data.data
                } else {
                    productData.images = []
                }
            } catch (imgError) {
                console.warn('Ëé∑Âèñ‰∫ßÂìÅÂõæÁâáÂ§±Ë¥•:', imgError)
                productData.images = []
            }

            product.value = productData
            currentImageIndex.value = 0
            
            // Ëé∑ÂèñÂ∫ìÂ≠ò‰ø°ÊÅØ
            await loadInventoryData(shoeId)
        } else {
            error.value = response.data?.message || 'Ëé∑Âèñ‰∫ßÂìÅËØ¶ÊÉÖÂ§±Ë¥•'
        }
    } catch (err) {
        console.error('Ëé∑Âèñ‰∫ßÂìÅËØ¶ÊÉÖÂ§±Ë¥•:', err)
        error.value = 'ÁΩëÁªúÈîôËØØÔºåËØ∑ÈáçËØï'
    } finally {
        loading.value = false
    }
}

// Ëé∑ÂèñÂ∫ìÂ≠òÊï∞ÊçÆ
const loadInventoryData = async (shoeId) => {
    try {
        const response = await axios.get(`/inventory/getInventoryByShoeId/${shoeId}`)
        console.log('Â∫ìÂ≠òÊé•Âè£ÂìçÂ∫î:', response.data) // Ê∑ªÂä†Ë∞ÉËØïÊó•Âøó
        
        if (response.data && response.data.code === 200 && response.data.data) {
            // Ê†πÊçÆÂêéÁ´ØËøîÂõûÁöÑÊï∞ÊçÆÁªìÊûÑÂ§ÑÁêÜ
            let inventoryArray = []
            
            if (Array.isArray(response.data.data)) {
                // Â¶ÇÊûúËøîÂõûÁöÑÊòØÊï∞ÁªÑ
                inventoryArray = response.data.data
            } else if (response.data.data.inventories) {
                // Â¶ÇÊûúËøîÂõûÁöÑÊòØÂåÖÂê´ inventories Â≠óÊÆµÁöÑÂØπË±°
                inventoryArray = response.data.data.inventories
            } else if (response.data.data.sizeInventories) {
                // Â¶ÇÊûúËøîÂõûÁöÑÊòØÂåÖÂê´ sizeInventories Â≠óÊÆµÁöÑÂØπË±°
                inventoryArray = response.data.data.sizeInventories
            } else {
                // Â¶ÇÊûúËøîÂõûÁöÑÊòØÂçï‰∏™Â∫ìÂ≠òÂØπË±°ÔºåËΩ¨Êç¢‰∏∫Êï∞ÁªÑ
                inventoryArray = [response.data.data]
            }
            
            console.log('Â§ÑÁêÜÂêéÁöÑÂ∫ìÂ≠òÊï∞ÁªÑ:', inventoryArray)
            inventoryData.value = inventoryArray
        } else {
            console.warn('Â∫ìÂ≠òÊé•Âè£ËøîÂõûÊï∞ÊçÆÂºÇÂ∏∏:', response.data)
            inventoryData.value = []
        }
    } catch (err) {
        console.error('Ëé∑ÂèñÂ∫ìÂ≠ò‰ø°ÊÅØÂ§±Ë¥•:', err)
        inventoryData.value = []
    }
}

// ÂõæÁâáÈÄâÊã©
const selectImage = (index) => {
    currentImageIndex.value = index
    showZoom.value = false
}

// ÂõæÁâáÊîæÂ§ßÈïúÊïàÊûú - ‰ºòÂåñÁâàÊú¨
const handleImageZoom = (event) => {
    if (!mainImageWrapper.value || !mainImage.value) return

    const rect = mainImageWrapper.value.getBoundingClientRect()
    const x = event.clientX - rect.left
    const y = event.clientY - rect.top

    const lensSize = 100
    const zoomLevel = 2

    // ËÆ°ÁÆóÊîæÂ§ßÈïú‰ΩçÁΩÆ
    const lensX = Math.max(0, Math.min(x - lensSize / 2, rect.width - lensSize))
    const lensY = Math.max(0, Math.min(y - lensSize / 2, rect.height - lensSize))

    // ËÆæÁΩÆÊîæÂ§ßÈïúÊ†∑Âºè
    zoomLensStyle.value = {
        left: `${lensX}px`,
        top: `${lensY}px`,
        width: `${lensSize}px`,
        height: `${lensSize}px`
    }

    // ËÆæÁΩÆÊîæÂ§ßÂõæÁâáÊ†∑Âºè - Ê†πÊçÆÈº†Ê†á‰ΩçÁΩÆËÆ°ÁÆóÂÅèÁßª
    const zoomedX = -(x * zoomLevel - lensSize / 2)
    const zoomedY = -(y * zoomLevel - lensSize / 2)

    zoomedImageStyle.value = {
        transform: `translate(${zoomedX}px, ${zoomedY}px) scale(${zoomLevel})`
    }

    showZoom.value = true
}

const hideZoom = () => {
    showZoom.value = false
}

// Â∞∫Á†ÅÈÄâÊã©
const selectSize = (sizeId) => {
    if (selectedSize.value === sizeId) {
        selectedSize.value = null
    } else {
        selectedSize.value = sizeId
        // ÈáçÁΩÆÊï∞Èáè‰∏∫1
        quantity.value = 1
    }
}

// Êï∞ÈáèÊéßÂà∂
const increaseQuantity = () => {
    if (quantity.value < maxQuantity.value) {
        quantity.value++
    }
}

const decreaseQuantity = () => {
    if (quantity.value > 1) {
        quantity.value--
    }
}

const validateQuantity = () => {
    if (quantity.value < 1) quantity.value = 1
    if (quantity.value > maxQuantity.value) quantity.value = maxQuantity.value
}

// Ëé∑ÂèñÂΩìÂâçÈÄâ‰∏≠Â∞∫Á†ÅÁöÑÂ∫ìÂ≠ò - ‰øÆÂ§ç‰∫ÜËøôÈáåÁöÑÈîôËØØ
const getCurrentSizeStock = () => {
    if (!selectedSize.value || !inventoryData.value || !Array.isArray(inventoryData.value)) return 0
    const selectedInventory = inventoryData.value.find(item => item.sizeId === selectedSize.value)
    return selectedInventory ? selectedInventory.inventoryNumber : 0
}

// Êìç‰ΩúÊåâÈíÆ
const addToCart = async () => {
    if (!selectedSize.value) {
        alert('ËØ∑ÂÖàÈÄâÊã©Â∞∫Á†Å')
        return
    }

    if (!product.value || !product.value.shoeId) {
        alert('ÂïÜÂìÅ‰ø°ÊÅØ‰∏çÂÆåÊï¥ÔºåËØ∑Âà∑Êñ∞ÂêéÈáçËØï')
        return
    }

    try {
        // Ëé∑ÂèñÂπ∂ËÆæÁΩÆÁî®Êà∑ID
        const userId = await userManager.getUserId()
        if (!userId) {
            alert('ËØ∑ÂÖàÁôªÂΩï')
            return
        }
        cartManager.setUserId(userId)

        // Ë∞ÉÁî®Ë¥≠Áâ©ËΩ¶ÁÆ°ÁêÜÂô®ÔºàÂèÇÊï∞È°∫Â∫èÔºösizeId, quantity, shoeIdÔºâ
        const ok = await cartManager.addToCart(selectedSize.value, quantity.value, product.value.shoeId)
        if (ok) {
            await cartManager.refreshCartCount()
            alert(`Â∑≤Â∞Ü ${product.value.name} Âä†ÂÖ•Ë¥≠Áâ©ËΩ¶`)
        } else {
            alert('Âä†ÂÖ•Ë¥≠Áâ©ËΩ¶Â§±Ë¥•ÔºåËØ∑ÈáçËØï')
        }
    } catch (err) {
        console.error('Âä†ÂÖ•Ë¥≠Áâ©ËΩ¶Â§±Ë¥•:', err)
        alert('Âä†ÂÖ•Ë¥≠Áâ©ËΩ¶Â§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúÊàñÁ®çÂêéÂÜçËØï')
    }
}

const buyNow = () => {
    if (!selectedSize.value) {
        alert('ËØ∑ÂÖàÈÄâÊã©Â∞∫Á†Å')
        return
    }
    
    // Ê£ÄÊü•ÊòØÂê¶‰ªéËÆ¢ÂçïÁ°ÆËÆ§È°µÈù¢Ë∑≥ËΩ¨ËøáÊù•
    const fromOrderConfirmation = sessionStorage.getItem('fromOrderConfirmation')
    
    // Ë∑≥ËΩ¨Âà∞ËÆ¢ÂçïÁ°ÆËÆ§È°µÈù¢Ôºå‰º†ÈÄíÂïÜÂìÅ‰ø°ÊÅØ
    router.push({
        name: 'OrderConfirmation',
        query: {
            productId: product.value.shoeId,
            sizeId: selectedSize.value,
            quantity: quantity.value,
            fromOrderConfirmation: fromOrderConfirmation ? 'true' : 'false'
        }
    })
}

// Ê†ºÂºèÂåñÊó•Êúü
const formatDate = (dateString) => {
    if (!dateString) return 'N/A'
    
    try {
        const date = new Date(dateString)
        return date.toLocaleDateString('zh-CN')
    } catch (err) {
        return dateString
    }
}

// ÁîüÂëΩÂë®Êúü
onMounted(() => {
    loadProductDetail()
})
</script>

<style scoped>
.product-detail-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
    font-family: 'Playfair Display', 'Georgia', serif;
}

/* Âä†ËΩΩÁä∂ÊÄÅ */
.loading-container {
    text-align: center;
    padding: 60px 20px;
}

.loading-spinner {
    width: 50px;
    height: 50px;
    border: 4px solid #f3f3f3;
    border-top: 4px solid rgb(211, 169, 101);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto 20px;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* ÈîôËØØÁä∂ÊÄÅ */
.error-container {
    text-align: center;
    padding: 60px 20px;
    color: #dc3545;
}

.error-icon {
    font-size: 3rem;
    margin-bottom: 20px;
}

.retry-btn {
    background: rgb(211, 169, 101);
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1rem;
    margin-top: 20px;
}

.sex-tag {
    background: rgba(231, 76, 60, 0.1);
    color: #e74c3c;
}

.retry-btn:hover {
    background: #d4af37;
}

/* Èù¢ÂåÖÂ±ëÂØºËà™ */
.breadcrumb {
    margin-bottom: 30px;
    padding: 15px 0;
    border-bottom: 1px solid #eee;
}

.breadcrumb-item {
    color: rgb(211, 169, 101);
    text-decoration: none;
    font-weight: 500;
}

.breadcrumb-item:hover {
    text-decoration: underline;
}

.breadcrumb-separator {
    margin: 0 10px;
    color: #999;
}

.breadcrumb-current {
    color: #666;
    font-weight: 600;
}

/* ‰∫ßÂìÅ‰∏ªË¶Å‰ø°ÊÅØÂå∫Âüü */
.product-main-section {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 40px;
    margin-bottom: 40px;
}

/* ÂõæÁâáÂ±ïÁ§∫Âå∫Âüü */
.product-images-section {
    position: relative;
}

.main-image-container {
    position: relative;
    margin-bottom: 20px;
}

.main-image-wrapper {
    position: relative;
    width: 100%;
    height: 400px;
    overflow: hidden;
    border-radius: 12px;
    cursor: zoom-in;
}

.main-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
}

.zoom-lens {
    position: absolute;
    border: 2px solid rgb(211, 169, 101);
    background: rgba(211, 169, 101, 0.1);
    pointer-events: none;
    z-index: 10;
}

.zoomed-image-container {
    position: absolute;
    top: 0;
    left: 100%;
    width: 400px;
    height: 400px;
    overflow: hidden;
    border-radius: 12px;
    border: 2px solid rgb(211, 169, 101);
    background: white;
    z-index: 20;
    margin-left: 20px;
}

.zoomed-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transform-origin: 0 0;
}

.thumbnail-list {
    display: flex;
    gap: 10px;
    overflow-x: auto;
    padding: 10px 0;
}

.thumbnail-item {
    flex-shrink: 0;
    width: 80px;
    height: 80px;
    border-radius: 8px;
    overflow: hidden;
    cursor: pointer;
    border: 2px solid transparent;
    transition: all 0.3s ease;
}

.thumbnail-item:hover {
    border-color: rgb(211, 169, 101);
}

.thumbnail-item.active {
    border-color: rgb(211, 169, 101);
    border-width: 3px;
}

.thumbnail-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

/* ‰∫ßÂìÅ‰ø°ÊÅØÂå∫Âüü */
.product-info-section {
    padding: 20px;
}

.product-title {
    font-size: 2rem;
    font-weight: 600;
    color: #333;
    margin: 0 0 20px 0;
    line-height: 1.3;
}

.product-serial {
    margin-bottom: 20px;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
}

.label {
    font-weight: 600;
    color: #666;
    margin-right: 10px;
}

.value {
    color: #333;
    font-weight: 500;
}

.price-section {
    margin-bottom: 25px;
}

.current-price {
    margin-bottom: 10px;
}

.current-price .price {
    font-size: 2rem;
    font-weight: 700;
    color: #e74c3c;
}

.original-price .price {
    font-size: 1.2rem;
    color: #999;
    text-decoration: line-through;
}

.points-section, .sales-section {
    margin-bottom: 20px;
    padding: 12px 0;
    border-bottom: 1px solid #eee;
}

.section-title {
    font-size: 1.2rem;
    font-weight: 600;
    color: #333;
    margin: 0 0 15px 0;
}

.size-section, .quantity-section {
    margin-bottom: 25px;
}

.size-options {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
}

.size-option {
    padding: 10px 20px;
    border: 2px solid #ddd;
    border-radius: 25px;
    background: white;
    color: #666;
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 500;
    position: relative;
    min-width: 80px;
    text-align: center;
}

.size-option:hover:not(.disabled) {
    border-color: rgb(211, 169, 101);
    color: rgb(211, 169, 101);
}

.size-option.selected {
    background: rgb(211, 169, 101);
    color: white;
    border-color: rgb(211, 169, 101);
}

.size-option.disabled {
    background: #f5f5f5;
    color: #ccc;
    border-color: #ddd;
    cursor: not-allowed;
}

.stock-info {
    font-size: 0.8rem;
    margin-left: 5px;
    opacity: 0.8;
}

.quantity-controls {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
}

.quantity-btn {
    width: 40px;
    height: 40px;
    border: 2px solid #ddd;
    background: white;
    color: #666;
    cursor: pointer;
    border-radius: 8px;
    font-size: 1.2rem;
    font-weight: 600;
    transition: all 0.3s ease;
}

.quantity-btn:hover:not(:disabled) {
    border-color: rgb(211, 169, 101);
    color: rgb(211, 169, 101);
}

.quantity-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.quantity-input {
    width: 80px;
    height: 40px;
    text-align: center;
    border: 2px solid #ddd;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 500;
}

.quantity-input:focus {
    outline: none;
    border-color: rgb(211, 169, 101);
}

.stock-warning {
    font-size: 0.9rem;
    color: #e74c3c;
    font-weight: 500;
}

.product-tags {
    display: flex;
    gap: 10px;
    margin-bottom: 25px;
    flex-wrap: wrap;
}

.tag {
    padding: 6px 12px;
    border-radius: 15px;
    font-size: 0.9rem;
    font-weight: 500;
}

.brand-tag {
    background: rgba(52, 152, 219, 0.1);
    color: #3498db;
}

.type-tag {
    background: rgba(46, 204, 113, 0.1);
    color: #2ecc71;
}

.color-tag {
    background: rgba(155, 89, 182, 0.1);
    color: #9b59b6;
}

.action-buttons {
    display: flex;
    gap: 15px;
    margin-bottom: 30px;
}

.add-to-cart-btn, .buy-now-btn {
    flex: 1;
    padding: 15px 20px;
    border: none;
    border-radius: 8px;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.add-to-cart-btn {
    background: linear-gradient(135deg, #28a745, #20c997);
    color: white;
}

.buy-now-btn {
    background: linear-gradient(135deg, #e74c3c, #c0392b);
    color: white;
}

.add-to-cart-btn:hover:not(:disabled), .buy-now-btn:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

.add-to-cart-btn:disabled, .buy-now-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
}

/* ‰∫ßÂìÅËØ¶ÁªÜ‰ø°ÊÅØ */
.product-details-section {
    background: white;
    border-radius: 12px;
    padding: 30px;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
}

.details-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.detail-item {
    display: flex;
    align-items: center;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
}

.detail-label {
    font-weight: 600;
    color: #666;
    min-width: 120px;
    margin-right: 15px;
}

.detail-value {
    color: #333;
    font-weight: 500;
}

.detail-value.discount {
    color: #e74c3c;
    font-weight: 600;
}

.description-section {
    border-top: 1px solid #eee;
    padding-top: 30px;
}

.subsection-title {
    font-size: 1.3rem;
    font-weight: 600;
    color: #333;
    margin: 0 0 20px 0;
}

.description-text {
    line-height: 1.8;
    color: #666;
    font-size: 1rem;
}

/* ÂìçÂ∫îÂºèËÆæËÆ° */
@media (max-width: 768px) {
    .product-main-section {
        grid-template-columns: 1fr;
        gap: 20px;
    }

    .main-image-wrapper {
        height: 300px;
    }

    .zoomed-image-container {
        display: none;
    }

    .details-grid {
        grid-template-columns: 1fr;
    }

    .action-buttons {
        flex-direction: column;
    }

    .size-options {
        justify-content: center;
    }
}

@media (max-width: 480px) {
    .product-detail-container {
        padding: 10px;
    }

    .product-title {
        font-size: 1.5rem;
    }

    .main-image-wrapper {
        height: 250px;
    }

    .thumbnail-item {
        width: 60px;
        height: 60px;
    }
}
</style>