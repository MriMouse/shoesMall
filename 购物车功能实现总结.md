# 购物车功能实现总结

## 已实现的功能

### 1. 后端功能

#### 1.1 订单管理API
- **加入购物车** (`POST /api/order/addToCart`)
  - 支持添加商品到购物车
  - 如果已有相同商品和尺码，会更新数量而不是创建新订单
  - 自动设置订单状态为10（购物车状态）

- **购物车结算** (`POST /api/order/checkout`)
  - 处理购物车中选中商品的结算
  - 返回订单信息和总金额

- **确认支付** (`POST /api/order/confirmPayment`)
  - 将购物车订单状态更新为1（已支付）
  - 支持批量处理多个订单

- **订单更新API**
  - 更新订单尺码 (`POST /api/order/updateOrderSize`)
  - 更新订单数量 (`POST /api/order/updateOrderQuantity`)
  - 更新订单状态 (`POST /api/order/updateOrderStatus`)

#### 1.2 数据库设计
- 使用 `orders` 表存储订单信息
- `status` 字段：10表示购物车，1表示已支付
- `order_shoe_num` 字段存储商品数量
- 支持外键约束确保数据完整性

### 2. 前端功能

#### 2.1 购物车页面 (`/cart`)
- **商品展示**
  - 显示购物车中的所有商品
  - 支持商品图片、名称、价格、尺码、数量等信息
  - 显示订单状态和积分信息

- **商品操作**
  - 选择/取消选择商品
  - 修改商品尺码和数量
  - 删除单个商品
  - 清空购物车

- **搜索功能**
  - 支持按商品名称、品牌、类型搜索
  - 搜索建议和历史记录

- **地址管理**
  - 选择配送地址
  - 显示默认地址

- **结算功能**
  - 计算选中商品的总金额和积分
  - 跳转到订单确认页面

#### 2.2 订单确认页面 (`/order-confirmation`)
- **支持多种来源**
  - 从产品详情页直接购买
  - 从购物车结算

- **支付流程**
  - 显示订单详情
  - 支付倒计时
  - 支付确认
  - 支付成功提示

#### 2.3 导航组件
- 购物车图标显示商品数量
- 用户登录状态管理
- 导航到各个页面

### 3. 核心业务流程

#### 3.1 加入购物车流程
1. 用户在商品详情页点击"加入购物车"
2. 前端调用 `addToCart` API
3. 后端检查是否已有相同商品和尺码的订单
4. 如果有，更新数量；如果没有，创建新订单
5. 设置订单状态为10（购物车状态）

#### 3.2 购物车结算流程
1. 用户在购物车页面选择要购买的商品
2. 选择配送地址
3. 点击"去结算"
4. 前端调用 `checkout` API
5. 跳转到订单确认页面

#### 3.3 支付确认流程
1. 用户在订单确认页面点击"确认支付"
2. 前端调用 `confirmPayment` API
3. 后端将订单状态更新为1（已支付）
4. 显示支付成功页面

### 4. 技术特点

#### 4.1 后端技术栈
- Spring Boot
- MyBatis
- MySQL
- RESTful API设计

#### 4.2 前端技术栈
- Vue 3
- Vue Router
- Axios
- 响应式设计

#### 4.3 数据一致性
- 使用事务确保数据一致性
- 外键约束保证数据完整性
- 状态管理确保订单状态正确

### 5. 测试功能

提供了测试页面 (`/test-cart`) 用于验证各个API功能：
- 加入购物车测试
- 获取购物车测试
- 结算测试
- 支付确认测试

### 6. 待完善功能

1. **库存管理**
   - 支付时检查库存
   - 支付成功后减少库存

2. **用户积分系统**
   - 支付成功后增加用户积分
   - 积分历史记录

3. **订单历史**
   - 查看已支付订单
   - 订单详情页面

4. **地址管理**
   - 添加、编辑、删除地址
   - 设置默认地址

5. **支付方式**
   - 支持多种支付方式
   - 支付状态跟踪

## 使用说明

1. 启动后端服务：`mvn spring-boot:run`
2. 启动前端服务：`npm run serve`
3. 访问测试页面：`http://localhost:8080/test-cart`
4. 访问购物车页面：`http://localhost:8080/cart`

## 注意事项

1. 确保数据库中有相应的用户、商品、尺码、地址数据
2. 用户需要先登录才能使用购物车功能
3. 测试时建议使用用户ID为1的测试用户
